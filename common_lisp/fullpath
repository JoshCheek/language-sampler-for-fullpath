#!/usr/bin/env clisp

(defun has-help (args)
  (or (find "-h"     *args* :test #'equal)
      (find "--help" *args* :test #'equal)))

(defun is-empty (list)
  (eq 0 (list-length list)))

(defun join (list delimiter)
  (if (is-empty list)
      ""
      (format nil "~a~a~a"
              (first list)
              delimiter
              (join (rest list) delimiter))))

(defun help-screen ()
  (join '("usage: fullpath *[relative-paths] [-c]"
          ""
          "  Prints the fullpath of the paths"
          "  If no paths are given as args, it will read them from stdin"
          ""
          "  If there is only one path, the trailing newline is omitted"
          ""
          "  The -c flag will copy the results into your pasteboard")
        "~%"))

(if (has-help *args*)
  (format t (help-screen))
  (loop for arg in *args*
        do (format t "~A~%" (absolute-pathname arg))))

; (princ (find  *args* "-h"))
; (princ (type-of (first *args*)))
; (princ "hello")
; (format t "~&~S~&" *args*)

; if there is a -h or --help in argv
;   print help
;   quit

; if there is a -c or --copy in argv
;   remove it
;   set do_copy to true
; otherwise
;   set do_copy to false

; paths =
;   if argv has paths
;     argv
;   otherwise
;     read the paths from stdin

; remove blank lines from paths

; to_print = for each path
;   expand it
;   join with newlines

; if there is more than one path
;   append a newline to to_print

; if do_copy is true
;   pass it as stdin to pbcopy

; print to_print
