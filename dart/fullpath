#!/usr/bin/env dart
import "dart:io";

class Fullpath {
  List<String>      args;
  Directory         cwd;
  Stream<List<int>> instream;
  IOSink            outstream;
  Fullpath(this.args, this.cwd, this.instream, this.outstream);

  call() {
    if(args.length == 0) {
      instream
        .map((bytes) {
          var line = new String.fromCharCodes(bytes);
          return line.replaceAll(new RegExp(r"\n$"), '');
        })
        .toList()
        .then(printPaths);
    } else
      printPaths(args);
  }

  printPaths(paths) {
    if(paths.length == 1) {
      outstream.write(path(paths[0]));
    } else {
      for(var filename in paths) {
        // this is kind of dumb, IMO, why even have this drectory class if it
        // won't let me do useful things like talk about a child of the dir?
        // This basically just casts it to a string and assumes the file separator
        // is a slash, which it wouldn't be on Windows, for example
        outstream.write(path(filename));
        outstream.write("\n");
      }
    }
  }

  path(filename) {
    return (cwd + "/" + filename).toString();
        // normalizePath
  }
}

main(List<String> args) {
  var cwd = Directory.current.path;
  new Fullpath(args, cwd, stdin, stdout).call();

  // print("*** Robot Stuffs ***");
  // var r = new Robot();
}
